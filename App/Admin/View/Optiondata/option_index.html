<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<include file="Common:head" />
 <script type="text/javascript">
        
        
    </script>
</head>
<body>
<table id="option_index_dg" title="数据字典" class="easyui-datagrid" style="width:700px;height:450px" url="<{:U('Optiondata/optionList')}>"  toolbar="#option_index_toolbar" pagination="true" pageSize='15' pageNumber='1' multiSort='true' sortOrder="desc" pageList="[10,15,20,25,30,40,50]" rownumbers="true" fitColumns="true" singleSelect="true">
        <thead>
            <tr>
            <!-- <th field="ck" checkbox="true"></th> -->
            <!-- 增加checkbox如果需要多选则需要将singleSelect设置为false -->
                <th field="id" width="15%" sortable="true">ID</th>
                <th field="course" width="15%"sortable="true">课程名称</th>
                <th field="type" width="15%">题目类型</th>
                <th field="title" width="55%">题干</th>
            </tr>
        </thead>
    </table>

    <div id="option_index_toolbar">
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="newUser()">添加</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true" >编辑</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" plain="true" >删除</a>
         <label>课程名称</label>
         <input id="toolbar_course_name" name="course_name">
         <label>题目类型</label>
         <input id="toolbar_option_type" name="option_name">
    </div>
    <style type="text/css">
        #fm{
            margin:0;
            padding:10px;
        }
		#fitem
		{
           margin:10px;
            padding:10px;
		}
        #optiontitle
        {
            width:600px;
            height: 80px;
        }
        #option
        {
            width: 600px;
            height: 50px;
        }
        
    </style>
   
    <script type="text/javascript">
    $(function(){
            $('#option_index_dg').datagrid({
                view: detailview,
                detailFormatter:function(index,row){
                    return '<div id="ddv-' + index + '" style="padding:5px 0"></div>';
                },
                onExpandRow: function(index,row){
                    $('#ddv-'+index).panel({
                        border:false,
                        cache:false,
                        href:'App/Admin/View/Optiondata/getOptionDetail.php?itemid='+row.id,
                        onLoad:function(){
                            $('#option_index_dg').datagrid('fixDetailRowHeight',index);
                        }
                    });
                    $('#option_index_dg').datagrid('fixDetailRowHeight',index);
                }
            }); 
        });
        var purl="<{:U('Dictdata/getDictNameJson')}>";
        purl+=purl.indexOf('?') != -1 ? '&id=200' : '?id=200';
        $('#toolbar_course_name').combobox({
            valueField:'type_id',
            textField:'type_name',
            panelHeight:'auto',
            url:purl,
            onSelect:onselect,
            onLoadSuccess:onCourseComboSuccess
         });
        purl="<{:U('Dictdata/getDictNameJson')}>";
        purl+=purl.indexOf('?') != -1 ? '&id=100' : '?id=100';
        $('#toolbar_option_type').combobox({
                valueField:'type_id',
                textField:'type_name',
                panelHeight:'auto',
                url:purl,
                onSelect:onselect,
                onLoadSuccess:onOptionComboSuccess

        });
        // $('#option_index_dg').datagrid({
        //         onLoadSuccess: function(data){
        //             if (data.total==0) {
        //                 alert("没有数据");
        //                 // $('#option_index_dg').datagrid('loadData',{total:0,rows:[]});
        //             }
        //         }
        //     });

        //添加会员对话窗
        function newUser(){
             window.open("<{:U('Optiondata/optionAdd')}>");  //打开一个新的页面
        }
       function onselect()
        {
            var pCourse=$('#toolbar_course_name').combobox('getValue');
            var pType=$('#toolbar_option_type').combobox('getValue');
             var param = {"courseid" :pCourse,"typeid":pType};
            $('#option_index_dg').datagrid('load',param);
        }
        function onOptionComboSuccess()
        {
            var val = $('#toolbar_option_type').combobox("getData");
            for (var item in val[0]) 
            {
                if (item == "type_id") 
                {
                    $('#toolbar_option_type').combobox("select", val[0][item]);
                }
            }
        }
        function onCourseComboSuccess()
        {
            var val = $('#toolbar_course_name').combobox("getData");
            // "\""+变量+"\""
            for (var item in val[0]) 
            {
                
                if (item == "type_id") 
                {
                    $('#toolbar_course_name').combobox("select", val[0][item]);
                }
            }
        }
        </script>
      </body>
      </html>